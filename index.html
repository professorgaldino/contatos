<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Tabela de Contatos - Layout Compacto</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      margin: 0;
      font-size: 14px;
    }
    .search-container {
      position: sticky;
      top: 0;
      background: white;
      padding: 12px 0;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #pesquisa {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .table-container {
      overflow-x: auto;
      margin-top: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      max-height: 80vh;
      overflow-y: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    th {
      background-color: #2c3e50;
      color: white;
      position: sticky;
      top: 0;
      font-weight: normal;
      font-size: 13px;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    .loading, .no-results {
      text-align: center;
      padding: 15px;
    }
    .no-results {
      color: #e74c3c;
    }
    .empty-field {
      color: #95a5a6;
      font-style: italic;
    }
    .has-value {
      background-color: #ecf0f1;
    }
    .clickable {
      cursor: pointer;
      color: #2980b9;
    }
    
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      width: 80%;
      max-width: 700px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: black;
    }
  </style>
</head>
<body>

<h2>Lista de Contatos</h2>
<div class="search-container">
  <input type="text" id="pesquisa" placeholder="Digite para filtrar em qualquer campo..." oninput="filtrarTabela()">
</div>

<div class="table-container">
  <table id="tabelaContatos">
    <thead>
      <tr>
        <th>First Name</th>
        <th>Middle Name</th>
        <th>Last Name</th>
        <th>Phonetic First Name</th>
        <th>Phonetic Middle Name</th>
        <th>Phonetic Last Name</th>
        <th>Name Prefix</th>
        <th>Name Suffix</th>
        <th>Nickname</th>
        <th>File As</th>
        <th>Organization Name</th>
        <th>Organization Title</th>
        <th>Organization Department</th>
        <th>Birthday</th>
        <th>Notes</th>
        <th>Photo</th>
        <th>Labels</th>
        <th>E-mail 1 - Label</th>
        <th>E-mail 1 - Value</th>
        <th>Phone 1 - Label</th>
        <th>Phone 1 - Value</th>
        <th>Phone 2 - Label</th>
        <th>Phone 2 - Value</th>
        <th>Phone 3 - Label</th>
        <th>Phone 3 - Value</th>
        <th>Phone 4 - Label</th>
        <th>Phone 4 - Value</th>
        <th>Address 1 - Label</th>
        <th>Address 1 - Formatted</th>
        <th>Address 1 - Street</th>
        <th>Address 1 - City</th>
        <th>Address 1 - PO Box</th>
        <th>Address 1 - Region</th>
        <th>Address 1 - Postal Code</th>
        <th>Address 1 - Country</th>
        <th>Address 1 - Extended Address</th>
      </tr>
    </thead>
    <tbody id="corpoTabela">
      <tr><td colspan="35" class="loading">Carregando dados dos contatos...</td></tr>
    </tbody>
  </table>
</div>

<!-- Modal de Detalhes -->
<div id="detailModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <div id="modalContent"></div>
  </div>
</div>

<script>
// Mapa de correção de acentuação
const mapaAcentos = {
  'Ã¡': 'á', 'Ã€': 'À', 'Ã‚': 'Â', 'Ãƒ': 'Ã',
  'ÃŠ': 'Ê', 'Ã‰': 'É', 'Ãˆ': 'È',
  'Ã': 'Í', 'ÃŒ': 'Ì',
  'Ã“': 'Ó', 'Ã’': 'Ò', 'Ã”': 'Ô', 'Ã•': 'Õ',
  'Ãš': 'Ú', 'Ã™': 'Ù',
  'Ã‡': 'Ç',
  'Â': '',
  'Ã§': 'ç',
  'Ã³': 'ó',
  'Ã£': 'ã',
  'Ã©': 'é',
  'Ãª': 'ê',
  'Ã­': 'í',
  'Ãµ': 'õ',
  'Ãº': 'ú',
  'Ã¨': 'è',
  'Ã¬': 'ì',
  'Ã¹': 'ù'
};

let contatos = [];
const modal = document.getElementById("detailModal");
const span = document.getElementsByClassName("close")[0];

// Fechar modal ao clicar no X
span.onclick = function() {
  modal.style.display = "none";
}

// Fechar modal ao clicar fora
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

function corrigirAcentos(texto) {
  if (typeof texto !== 'string') return texto;
  
  let corrigido = texto;
  for (let erro in mapaAcentos) {
    corrigido = corrigido.split(erro).join(mapaAcentos[erro]);
  }
  return corrigido;
}

function formatarTelefone(telefone) {
  if (!telefone) return '';
  const tel = telefone.replace(/\D/g, '');
  if (tel.length === 11) {
    return `(${tel.slice(0, 2)}) ${tel.slice(2, 7)}-${tel.slice(7)}`;
  } else if (tel.length === 10) {
    return `(${tel.slice(0, 2)}) ${tel.slice(2, 6)}-${tel.slice(6)}`;
  }
  return telefone;
}

function mostrarDetalhes(contato) {
  const modalContent = document.getElementById("modalContent");
  
  // Organiza os dados em grupos lógicos
  const html = `
    <h2>${corrigirAcentos([contato["First Name"], contato["Middle Name"], contato["Last Name"]].filter(Boolean).join(" "))}</h2>
    
    <h3>Informações Básicas</h3>
    <p><strong>Organização:</strong> ${contato["Organization Name"] || '-'}</p>
    <p><strong>Cargo:</strong> ${contato["Organization Title"] || '-'}</p>
    <p><strong>Departamento:</strong> ${contato["Organization Department"] || '-'}</p>
    
    <h3>Contatos</h3>
    <p><strong>E-mail:</strong> ${contato["E-mail 1 - Value"] || '-'}</p>
    <p><strong>${contato["Phone 1 - Label"] || 'Telefone'}:</strong> ${contato["Phone 1 - Value"] ? formatarTelefone(contato["Phone 1 - Value"]) : '-'}</p>
    <p><strong>${contato["Phone 2 - Label"] || 'Telefone 2'}:</strong> ${contato["Phone 2 - Value"] ? formatarTelefone(contato["Phone 2 - Value"]) : '-'}</p>
    
    <h3>Endereço</h3>
    <p>${contato["Address 1 - Formatted"] || contato["Address 1 - Street"] || '-'}</p>
    <p>${[contato["Address 1 - City"], contato["Address 1 - Region"]].filter(Boolean).join(", ") || '-'}</p>
    <p>${contato["Address 1 - Postal Code"] || ''} ${contato["Address 1 - Country"] || ''}</p>
    
    <h3>Outras Informações</h3>
    <p><strong>Aniversário:</strong> ${contato["Birthday"] || '-'}</p>
    <p><strong>Notas:</strong> ${contato["Notes"] || '-'}</p>
  `;
  
  modalContent.innerHTML = html;
  modal.style.display = "block";
}

function renderizarTabela(dados) {
  const tbody = document.getElementById("corpoTabela");
  tbody.innerHTML = "";

  if (dados.length === 0) {
    tbody.innerHTML = `<tr><td colspan="35" class="no-results">Nenhum resultado encontrado</td></tr>`;
    return;
  }

  dados.forEach(contato => {
    const tr = document.createElement("tr");
    
    // Primeiro nome (clicável)
    const tdFirstName = document.createElement("td");
    tdFirstName.innerHTML = contato["First Name"] ? corrigirAcentos(contato["First Name"]) : '<span class="empty-field">-</span>';
    tdFirstName.classList.add("clickable");
    if (contato["First Name"]) tdFirstName.classList.add("has-value");
    tdFirstName.onclick = () => mostrarDetalhes(contato);
    tr.appendChild(tdFirstName);
    
    // Middle Name
    const tdMiddle = document.createElement("td");
    tdMiddle.innerHTML = contato["Middle Name"] ? corrigirAcentos(contato["Middle Name"]) : '<span class="empty-field">-</span>';
    if (contato["Middle Name"]) tdMiddle.classList.add("has-value");
    tr.appendChild(tdMiddle);
    
    // Last Name
    const tdLast = document.createElement("td");
    tdLast.innerHTML = contato["Last Name"] ? corrigirAcentos(contato["Last Name"]) : '<span class="empty-field">-</span>';
    if (contato["Last Name"]) tdLast.classList.add("has-value");
    tr.appendChild(tdLast);
    
    // Demais campos (não clicáveis)
    const camposRestantes = [
      "Phonetic First Name", "Phonetic Middle Name", "Phonetic Last Name",
      "Name Prefix", "Name Suffix", "Nickname", "File As",
      "Organization Name", "Organization Title", "Organization Department",
      "Birthday", "Notes", "Photo", "Labels",
      "E-mail 1 - Label", "E-mail 1 - Value",
      "Phone 1 - Label", "Phone 1 - Value",
      "Phone 2 - Label", "Phone 2 - Value",
      "Phone 3 - Label", "Phone 3 - Value",
      "Phone 4 - Label", "Phone 4 - Value",
      "Address 1 - Label", "Address 1 - Formatted",
      "Address 1 - Street", "Address 1 - City", "Address 1 - PO Box",
      "Address 1 - Region", "Address 1 - Postal Code", "Address 1 - Country",
      "Address 1 - Extended Address"
    ];
    
    camposRestantes.forEach(campo => {
      const td = document.createElement("td");
      const valor = contato[campo];
      td.innerHTML = valor ? corrigirAcentos(valor.toString()) : '<span class="empty-field">-</span>';
      td.title = valor ? corrigirAcentos(valor.toString()) : '';
      if (valor) td.classList.add("has-value");
      tr.appendChild(td);
    });
    
    tbody.appendChild(tr);
  });
}

function filtrarTabela() {
  const termo = document.getElementById("pesquisa").value.toLowerCase();
  
  if (!termo) {
    renderizarTabela(contatos);
    return;
  }

  const resultados = contatos.filter(contato => {
    return Object.keys(contato).some(campo => {
      const valor = contato[campo];
      return valor && corrigirAcentos(valor.toString().toLowerCase()).includes(termo);
    });
  });

  renderizarTabela(resultados);
}

// Carregar dados
fetch('contatos.json')
  .then(response => response.json())
  .then(data => {
    contatos = Array.isArray(data) ? data : [data];
    renderizarTabela(contatos);
    
    // Ajustar automaticamente as larguras das colunas
    setTimeout(() => {
      const ths = document.querySelectorAll('th');
      ths.forEach(th => {
        const contentWidth = th.textContent.length * 8 + 20; // Largura baseada no conteúdo
        th.style.width = `${Math.max(contentWidth, 80)}px`; // Mínimo de 80px
      });
    }, 100);
  })
  .catch(error => {
    document.getElementById("corpoTabela").innerHTML = 
      `<tr><td colspan="35" class="no-results">Erro ao carregar: ${error.message}</td></tr>`;
    console.error("Erro:", error);
  });
</script>
</body>
</html>
