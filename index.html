<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Tabela de Contatos - Visualização Específica</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    .search-container {
      position: sticky;
      top: 0;
      background: white;
      padding: 15px 0;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #pesquisa {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .table-container {
      overflow-x: auto;
      margin-top: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1200px;
    }
    th, td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      white-space: nowrap;
    }
    th {
      background-color: #007bff;
      color: white;
      position: sticky;
      top: 60px;
      font-weight: normal;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    .loading, .no-results {
      text-align: center;
      padding: 20px;
    }
    .no-results {
      color: #ff6b6b;
    }
    .empty-field {
      color: #999;
      font-style: italic;
    }
    .highlight {
      background-color: #fffde7;
    }
  </style>
</head>
<body>

<h2>Lista de Contatos - Estrutura Específica</h2>
<div class="search-container">
  <input type="text" id="pesquisa" placeholder="Pesquisar em todos os campos..." oninput="filtrarTabela()">
</div>

<div class="table-container">
  <table id="tabelaContatos">
    <thead id="cabecalhoTabela">
      <!-- Cabeçalho será gerado dinamicamente na ordem específica -->
    </thead>
    <tbody id="corpoTabela">
      <tr><td colspan="100%" class="loading">Carregando dados...</td></tr>
    </tbody>
  </table>
</div>

<script>
let contatos = [];

// Ordem específica dos campos que você definiu
const ordemCampos = [
  "First Name", "Middle Name", "Last Name", 
  "Phonetic First Name", "Phonetic Middle Name", "Phonetic Last Name",
  "Name Prefix", "Name Suffix", "Nickname", "File As",
  "Organization Name", "Organization Title", "Organization Department",
  "Birthday", "Notes", "Photo", "Labels",
  "E-mail 1 - Label", "E-mail 1 - Value",
  "Phone 1 - Label", "Phone 1 - Value",
  "Phone 2 - Label", "Phone 2 - Value",
  "Phone 3 - Label", "Phone 3 - Value",
  "Phone 4 - Label", "Phone 4 - Value",
  "Address 1 - Label", "Address 1 - Formatted",
  "Address 1 - Street", "Address 1 - City", "Address 1 - PO Box",
  "Address 1 - Region", "Address 1 - Postal Code", "Address 1 - Country",
  "Address 1 - Extended Address"
];

// Função para corrigir caracteres mal codificados
function corrigirEncoding(texto) {
  if (!texto) return "";
  const mapa = {
    'Ã¡': 'á', 'Ã€': 'À', 'Ã‚': 'Â', 'Ãƒ': 'Ã',
    'ÃŠ': 'Ê', 'Ã‰': 'É', 'Ãˆ': 'È',
    'Ã': 'Í', 'ÃŒ': 'Ì',
    'Ã“': 'Ó', 'Ã’': 'Ò', 'Ã”': 'Ô', 'Ã•': 'Õ',
    'Ãš': 'Ú', 'Ã™': 'Ù',
    'Ã‡': 'Ç',
    'Â': ''
  };
  let corrigido = texto;
  for (let erro in mapa) {
    corrigido = corrigido.split(erro).join(mapa[erro]);
  }
  return corrigido;
}

// Função para formatar valores
function formatarValor(valor) {
  if (valor === null || valor === undefined || valor === "") {
    return '<span class="empty-field">(vazio)</span>';
  }
  return corrigirEncoding(valor.toString());
}

// Função para renderizar o cabeçalho na ordem específica
function renderizarCabecalho() {
  const cabecalho = document.getElementById("cabecalhoTabela");
  cabecalho.innerHTML = "";
  
  const linha = document.createElement("tr");
  ordemCampos.forEach(chave => {
    const th = document.createElement("th");
    th.textContent = chave;
    linha.appendChild(th);
  });
  cabecalho.appendChild(linha);
}

// Função para renderizar os dados na tabela
function renderizarTabela(lista) {
  const corpo = document.getElementById("corpoTabela");
  corpo.innerHTML = "";

  if (lista.length === 0) {
    corpo.innerHTML = `<tr><td colspan="${ordemCampos.length}" class="no-results">Nenhum contato encontrado.</td></tr>`;
    return;
  }

  lista.forEach(contato => {
    const linha = document.createElement("tr");
    
    ordemCampos.forEach(chave => {
      const td = document.createElement("td");
      td.innerHTML = formatarValor(contato[chave]);
      linha.appendChild(td);
    });
    
    corpo.appendChild(linha);
  });
}

// Função para filtrar a tabela
function filtrarTabela() {
  const termo = document.getElementById("pesquisa").value.toLowerCase();
  
  if (!termo) {
    renderizarTabela(contatos);
    return;
  }

  const filtrados = contatos.filter(contato => {
    return ordemCampos.some(chave => {
      const valor = contato[chave];
      return valor && valor.toString().toLowerCase().includes(termo);
    });
  });

  renderizarTabela(filtrados);
}

// Carrega os dados do JSON
fetch('contatos.json')
  .then(response => response.json())
  .then(data => {
    contatos = Array.isArray(data) ? data : [data];
    renderizarCabecalho();
    renderizarTabela(contatos);
    
    // Destacar campos com valores (opcional)
    document.querySelectorAll('td').forEach(td => {
      if (!td.querySelector('.empty-field')) {
        td.classList.add('highlight');
      }
    });
  })
  .catch(error => {
    document.getElementById("corpoTabela").innerHTML = 
      `<tr><td colspan="${ordemCampos.length}" class="no-results">Erro ao carregar contatos: ${error.message}</td></tr>`;
    console.error("Erro ao carregar JSON:", error);
  });
</script>

</body>
</html>
