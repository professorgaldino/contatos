<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Tabela de Contatos - Layout Otimizado</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      margin: 0;
      font-size: 14px;
    }
    .search-container {
      position: sticky;
      top: 0;
      background: white;
      padding: 12px 0;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #pesquisa {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .table-container {
      overflow-x: auto;
      margin-top: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      max-height: 80vh;
      overflow-y: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    th, td {
      padding: 8px 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px;
    }
    th {
      background-color: #2c3e50;
      color: white;
      position: sticky;
      top: 0;
      font-weight: normal;
      font-size: 13px;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    .loading, .no-results {
      text-align: center;
      padding: 15px;
    }
    .no-results {
      color: #e74c3c;
    }
    .empty-field {
      color: #95a5a6;
      font-style: italic;
    }
    .has-value {
      background-color: #ecf0f1;
    }
  </style>
</head>
<body>

<h2>Lista de Contatos</h2>
<div class="search-container">
  <input type="text" id="pesquisa" placeholder="Digite para filtrar em qualquer campo..." oninput="filtrarTabela()">
</div>

<div class="table-container">
  <table id="tabelaContatos">
    <thead>
      <tr>
        <th style="width:120px">First Name</th>
        <th style="width:100px">Middle Name</th>
        <th style="width:120px">Last Name</th>
        <th style="width:120px">Phonetic First</th>
        <th style="width:100px">Phonetic Middle</th>
        <th style="width:120px">Phonetic Last</th>
        <th style="width:80px">Name Prefix</th>
        <th style="width:80px">Name Suffix</th>
        <th style="width:100px">Nickname</th>
        <th style="width:100px">File As</th>
        <th style="width:150px">Organization</th>
        <th style="width:120px">Org. Title</th>
        <th style="width:150px">Org. Department</th>
        <th style="width:80px">Birthday</th>
        <th style="width:200px">Notes</th>
        <th style="width:80px">Photo</th>
        <th style="width:100px">Labels</th>
        <th style="width:100px">E-mail 1 Label</th>
        <th style="width:180px">E-mail 1 Value</th>
        <th style="width:100px">Phone 1 Label</th>
        <th style="width:120px">Phone 1 Value</th>
        <th style="width:100px">Phone 2 Label</th>
        <th style="width:120px">Phone 2 Value</th>
        <th style="width:100px">Phone 3 Label</th>
        <th style="width:120px">Phone 3 Value</th>
        <th style="width:100px">Phone 4 Label</th>
        <th style="width:120px">Phone 4 Value</th>
        <th style="width:100px">Address Label</th>
        <th style="width:200px">Address Formatted</th>
        <th style="width:150px">Street</th>
        <th style="width:100px">City</th>
        <th style="width:80px">PO Box</th>
        <th style="width:100px">Region</th>
        <th style="width:80px">Postal Code</th>
        <th style="width:100px">Country</th>
        <th style="width:150px">Ext. Address</th>
      </tr>
    </thead>
    <tbody id="corpoTabela">
      <tr><td colspan="35" class="loading">Carregando dados dos contatos...</td></tr>
    </tbody>
  </table>
</div>

<script>
// Lista fixa de campos na ordem exata que você definiu
const CAMPOS = [
  "First Name", "Middle Name", "Last Name",
  "Phonetic First Name", "Phonetic Middle Name", "Phonetic Last Name",
  "Name Prefix", "Name Suffix", "Nickname", "File As",
  "Organization Name", "Organization Title", "Organization Department",
  "Birthday", "Notes", "Photo", "Labels",
  "E-mail 1 - Label", "E-mail 1 - Value",
  "Phone 1 - Label", "Phone 1 - Value",
  "Phone 2 - Label", "Phone 2 - Value",
  "Phone 3 - Label", "Phone 3 - Value",
  "Phone 4 - Label", "Phone 4 - Value",
  "Address 1 - Label", "Address 1 - Formatted",
  "Address 1 - Street", "Address 1 - City", "Address 1 - PO Box",
  "Address 1 - Region", "Address 1 - Postal Code", "Address 1 - Country",
  "Address 1 - Extended Address"
];

// Mapa de correção de acentuação
const mapaAcentos = {
  'Ã¡': 'á', 'Ã€': 'À', 'Ã‚': 'Â', 'Ãƒ': 'Ã',
  'ÃŠ': 'Ê', 'Ã‰': 'É', 'Ãˆ': 'È',
  'Ã': 'Í', 'ÃŒ': 'Ì',
  'Ã“': 'Ó', 'Ã’': 'Ò', 'Ã”': 'Ô', 'Ã•': 'Õ',
  'Ãš': 'Ú', 'Ã™': 'Ù',
  'Ã‡': 'Ç',
  'Â': '',
  'Ã§': 'ç',
  'Ã³': 'ó',
  'Ã£': 'ã',
  'Ã©': 'é',
  'Ãª': 'ê',
  'Ã­': 'í',
  'Ãµ': 'õ',
  'Ãº': 'ú',
  'Ã¨': 'è',
  'Ã¬': 'ì',
  'Ã¹': 'ù'
};

let contatos = [];

function corrigirAcentos(texto) {
  if (typeof texto !== 'string') return texto;
  
  let corrigido = texto;
  for (let erro in mapaAcentos) {
    corrigido = corrigido.split(erro).join(mapaAcentos[erro]);
  }
  return corrigido;
}

function formatarValor(valor) {
  if (valor === null || valor === undefined || valor === "") {
    return '<span class="empty-field">-</span>';
  }
  return corrigirAcentos(valor.toString());
}

function renderizarTabela(dados) {
  const tbody = document.getElementById("corpoTabela");
  tbody.innerHTML = "";

  if (dados.length === 0) {
    tbody.innerHTML = `<tr><td colspan="${CAMPOS.length}" class="no-results">Nenhum resultado encontrado</td></tr>`;
    return;
  }

  dados.forEach(contato => {
    const tr = document.createElement("tr");
    
    CAMPOS.forEach(campo => {
      const td = document.createElement("td");
      const valor = contato[campo];
      td.innerHTML = formatarValor(valor);
      td.title = formatarValor(valor); // Tooltip com conteúdo completo
      
      if (valor) td.classList.add("has-value");
      tr.appendChild(td);
    });
    
    tbody.appendChild(tr);
  });
}

function filtrarTabela() {
  const termo = document.getElementById("pesquisa").value.toLowerCase();
  
  if (!termo) {
    renderizarTabela(contatos);
    return;
  }

  const resultados = contatos.filter(contato => {
    return CAMPOS.some(campo => {
      const valor = contato[campo];
      return valor && corrigirAcentos(valor.toString().toLowerCase()).includes(termo);
    });
  });

  renderizarTabela(resultados);
}

// Carregar dados
fetch('contatos.json')
  .then(response => response.json())
  .then(data => {
    contatos = Array.isArray(data) ? data : [data];
    renderizarTabela(contatos);
  })
  .catch(error => {
    document.getElementById("corpoTabela").innerHTML = 
      `<tr><td colspan="${CAMPOS.length}" class="no-results">Erro ao carregar: ${error.message}</td></tr>`;
    console.error("Erro:", error);
  });
</script>
</body>
</html>
